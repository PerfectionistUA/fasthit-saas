# –ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω—ñ —Ä–æ–ª—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏ (Spatie Laravel Permission 6 + teams)

---

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—É—î, —è–∫ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π —Ç–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ —É FastHit SaaS –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø–∞–∫–µ—Ç [Spatie Laravel Permission](https://spatie.be/docs/laravel-permission/v6/introduction).

–ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –∫–æ–º–∞–Ω–¥ (Teams) Spatie –¥–ª—è —Ä–æ–∑–º–µ–∂—É–≤–∞–Ω–Ω—è —Ä–æ–ª–µ–π —Ç–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ –º—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏ —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏.

## 1. –ö–ª—é—á–æ–≤—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏

1.  **–¢–µ–Ω–∞–Ω—Ç —è–∫ "–ö–æ–º–∞–Ω–¥–∞":** –ö–æ–∂–µ–Ω `Tenant` —É –Ω–∞—à—ñ–π —Å–∏—Å—Ç–µ–º—ñ —Ä–æ–∑–≥–ª—è–¥–∞—î—Ç—å—Å—è Spatie —è–∫ –æ–∫—Ä–µ–º–∞ "–∫–æ–º–∞–Ω–¥–∞" (`team`). –¶–µ –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –º–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ —Ä–æ–ª—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –∫–æ–∂–Ω–æ–≥–æ —Ç–µ–Ω–∞–Ω—Ç–∞.
2.  **–ì–ª–æ–±–∞–ª—å–Ω—ñ —Ä–æ–ª—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏:** –û–∫—Ä—ñ–º —Ç–µ–Ω–∞–Ω—Ç-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö —Ä–æ–ª–µ–π, —ñ—Å–Ω—É—é—Ç—å —Ç–∞–∫–æ–∂ –≥–ª–æ–±–∞–ª—å–Ω—ñ —Ä–æ–ª—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏, —è–∫—ñ –¥—ñ—é—Ç—å –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–µ–Ω–∞–Ω—Ç–∞.
3.  **–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ç–µ–Ω–∞–Ω—Ç–∞ (`tenant_id`):** –î–ª—è —Ä–æ–∑—Ä—ñ–∑–Ω–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ–≤ Spatie –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø–æ–ª–µ `tenant_id` —É —Å–≤–æ—ó—Ö pivot-—Ç–∞–±–ª–∏—Ü—è—Ö.

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–∞–∑–∏ –î–∞–Ω–∏—Ö (Primary Key)

–î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –∫–æ—Ä–µ–∫—Ç–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—ñ, –ø–µ—Ä–≤–∏–Ω–Ω—ñ –∫–ª—é—á—ñ –Ω–∞ pivot-—Ç–∞–±–ª–∏—Ü—è—Ö Spatie –≤–∫–ª—é—á–∞—é—Ç—å `tenant_id`. –¶–µ –¥–æ–∑–≤–æ–ª—è—î —É–Ω–∏–∫–Ω—É—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ —É–Ω—ñ–∫–∞–ª—å–Ω–æ—Å—Ç—ñ, –∫–æ–ª–∏ –æ–¥–∏–Ω —ñ —Ç–æ–π –∂–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –æ–¥–Ω–∞–∫–æ–≤—É —Ä–æ–ª—å —É —Ä—ñ–∑–Ω–∏—Ö —Ç–µ–Ω–∞–Ω—Ç–∞—Ö.

> TL;DR ‚Äì **tenant_id = 0 ‚âô –≥–ª–æ–±–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.**  
> –£—Å—ñ –∑–∞–ø–∏—Ç–∏ Spatie –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–±–∏—Ç–∏ **–∞–±–æ** —É `globalTeamId()` (0), **–∞–±–æ** —É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É `tenant_id` —á–µ—Ä–µ–∑ `PermissionRegistrar::setPermissionsTeamId()`.

---

## 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—å ‚Üî PK

| –¢–∞–±–ª–∏—Ü—è                | –ü–µ—Ä–≤–∏–Ω–Ω–∏–π –∫–ª—é—á (PK)                              | –î–æ–¥–∞—Ç–∫–æ–≤–æ                |
|------------------------|--------------------------------------------------|--------------------------|
| `roles`                | `id` _(bigint)_                                  | **tenant_id NOT NULL**¬π  |
| `permissions`          | `id` _(bigint)_                                  |                          |
| `model_has_roles`      | `(role_id, model_type, model_id, tenant_id)`     | **tenant_id NOT NULL**   |
| `model_has_permissions`| `(permission_id, model_type, model_id, tenant_id)`| **tenant_id NOT NULL**   |

¬π `tenant_id = 0` ‚Äì _–≥–ª–æ–±–∞–ª—å–Ω–∞ —Ä–æ–ª—å_ (–≤–∏–¥–Ω–æ –≤—Å—ñ–º —Ç–µ–Ω–∞–Ω—Ç–∞–º). –ë—É–¥—å-—è–∫–∞ —ñ–Ω—à–∞ ‚Äì —Ä–æ–ª—å/–¥–æ–∑–≤—ñ–ª –≤–∏–∫–ª—é—á–Ω–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–≤–æ–≥–æ —Ç–µ–Ω–∞–Ω—Ç–∞.

**–í–∞–∂–ª–∏–≤–æ:** –¶–µ –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è "–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á + —Ä–æ–ª—å" —î —É–Ω—ñ–∫–∞–ª—å–Ω–æ—é **–Ω–µ –ª–∏—à–µ –≤ –º–µ–∂–∞—Ö –ø–µ–≤–Ω–æ–≥–æ —Ç–µ–Ω–∞–Ω—Ç–∞ –∞–±–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É**.

---

## 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞–∫–µ—Ç–∞

`config/permission.php`

```php
'teams'          => true,
'team_foreign_key' => 'tenant_id',
'global_team_id'   => 0,   // üëà ‚Äú–Ω—É–ª—å–æ–≤–∏–π‚Äù ‚Äì –≥–ª–æ–±–∞–ª—å–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
```

(app/Support/helpers.php)
```php
if (! function_exists('globalTeamId')) {
    function globalTeamId(): int
    {
        return (int) config('permission.global_team_id', 0);
    }
}```

`AppServiceProvider::boot()`

```php
app(PermissionRegistrar::class)->setPermissionsTeamId(globalTeamId());
```
> –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∑–∞ –∑–∞–º–æ–≤—á–∞–Ω–Ω—è–º —É–≤–µ—Å—å –∫–æ–¥ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —É –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ.

## 3. –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ –í—ñ–¥–∫–ª–∏–∫–∞–Ω–Ω—è –†–æ–ª–µ–π/–î–æ–∑–≤–æ–ª—ñ–≤

---

### 3.1. –ì–ª–æ–±–∞–ª—å–Ω—ñ —Ä–æ–ª—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏

–ü—Ä–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è –±–µ–∑ –≤–∫–∞–∑–∞–Ω–Ω—è `tenant_id`. Spatie –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î —ó—Ö –∑ `tenant_id = 0`.

```php
$user->assignRole('super-admin');          // tenant_id = 0
$user->givePermissionTo('view-dashboard'); // tenant_id = 0
```

### 3.2. –¢–µ–Ω–∞–Ω—Ç-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ —Ä–æ–ª—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏

```php
u$registrar = app(PermissionRegistrar::class);
$registrar->setPermissionsTeamId($tenant->id);

$user->assignRole('editor');               // tenant_id = $tenant->id
$user->givePermissionTo('create_post');    // tenant_id = $tenant->id

$registrar->setPermissionsTeamId(null);    // –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—è —É global
```

> –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π –¥—Ä—É–≥–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç assignRole($role, $teamId) ‚Äì —Ü–µ deprecated.
> –ö–∞–Ω–æ–Ω—ñ—á–Ω–∏–π —Å–ø–æ—Å—ñ–± ‚Äì –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–æ–∫–ª–∞–¥–∞—Ç–∏—Å—è –Ω–∞ setPermissionsTeamId().*

---

## 4. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø—É

```php
// —É –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É –∫–æ–¥—ñ:
$user->hasRole('super-admin');                     // true/false

// —É—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ç–µ–Ω–∞–Ω—Ç–∞:
app(PermissionRegistrar::class)->setPermissionsTeamId($tenant->id);
$user->can('create_post');                         // true/false
```

---

## 2. Observer: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥–∫–ª–∏–∫–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É

`app/Observers/UserObserver.php`

–ø—Ä–∏ status = suspended | inactive | soft-delete

- –≤—ñ–¥–∫–ª–∏–∫–∞—î –≤—Å—ñ —Ä–æ–ª—ñ/–¥–æ–∑–≤–æ–ª–∏ —É –∫–æ–∂–Ω–æ–º—É tenant-–∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ

- –≤–∏–¥–∞–ª—è—î Sanctum-—Ç–æ–∫–µ–Ω–∏

- —á–∏—Å—Ç–∏—Ç—å –∫–µ—à Spatie\Permission

(–¥–∏–≤. —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—é —É –∫–æ–¥—ñ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é).

–û–±—Å–µ—Ä–≤–µ—Ä UserObserver –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥–∫–ª–∏–∫–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –π–æ–≥–æ —Å—Ç–∞—Ç—É—Å—É –∞–±–æ –ø—Ä–∏ –º'—è–∫–æ–º—É –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ.

–ö–æ–ª–∏ —Å—Ç–∞—Ç—É—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ suspended –∞–±–æ inactive, –æ–±—Å–µ—Ä–≤–µ—Ä –≤–∏–∫–ª–∏–∫–∞—î –º–µ—Ç–æ–¥ revokeUserAccess().

–ü—Ä–∏ –º'—è–∫–æ–º—É –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (soft-delete), —Ç–∞–∫–æ–∂ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è revokeUserAccess() —Ç–∞ –≤—ñ–¥'—î–¥–Ω–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤—ñ–¥ —É—Å—ñ—Ö —Ç–µ–Ω–∞–Ω—Ç—ñ–≤.

–ú–µ—Ç–æ–¥ revokeUserAccess() –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î syncRoles([]) —Ç–∞ syncPermissions([]) —è–∫ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö —Ä–æ–ª–µ–π (–±–µ–∑ tenant_id), —Ç–∞–∫ —ñ –¥–ª—è —Ä–æ–ª–µ–π —É –∫–æ–∂–Ω–æ–º—É —Ç–µ–Ω–∞–Ω—Ç—ñ (–∑ —è–≤–Ω–∏–º tenant_id). –¶–µ –≥–∞—Ä–∞–Ω—Ç—É—î –ø–æ–≤–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É.

---

## Seeder-–∏

*RoleSeeder*

- super-admin ‚Üí tenant_id = 0

- —à–∞–±–ª–æ–Ω–Ω—ñ —Ä–æ–ª—ñ (–±–µ–∑ tenant_id) ‚Äì –∫–æ–ø—ñ—é—é—Ç—å—Å—è —É –∫–æ–∂–µ–Ω –Ω–æ–≤–∏–π —Ç–µ–Ω–∞–Ω—Ç –∑–∞ –ø–æ—Ç—Ä–µ–±–∏.

*SuperAdminSeeder*

- —Å—Ç–≤–æ—Ä—é—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –π –ø—Ä–∏–∑–Ω–∞—á–∞—î –π–æ–º—É super-admin —É –≥–ª–æ–±–∞–ª—å–Ω—ñ–π –∫–æ–º–∞–Ω–¥—ñ.

---

## 7. –ü–∞–º‚Äô—è—Ç–∫–∞ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—É

1. –ó–∞–≤–∂–¥–∏ —è–≤–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–π setPermissionsTeamId() –ø–µ—Ä–µ–¥ –º–∞—Å–æ–≤–∏–º–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è–º–∏ Spatie.

2. –ù—ñ–∫–æ–ª–∏ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞–π –∑–Ω–∞—á–µ–Ω–Ω—è tenant_id = NULL ‚Äì —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π PK —Ü–µ –∑–∞–±–æ—Ä–æ–Ω—è—î.

3. –î–ª—è –≥–ª–æ–±–∞–ª—å–Ω–∏—Ö —Ä–æ–ª–µ–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è tenant_id = 0.

4. –£ —Ç–µ—Å—Ç–∞—Ö:

```php
$this->app[PermissionRegistrar::class]->setPermissionsTeamId($tenantId);
—ñ –Ω–µ –∑–∞–±—É–≤–∞–π –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ null –Ω–∞–ø—Ä–∏–∫—ñ–Ω—Ü—ñ.
```

–ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ñ —Ç–µ—Å—Ç—ñ–≤ –¥–ª—è —Ä–æ–ª–µ–π —Ç–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ –≤–∞–∂–ª–∏–≤–æ –≤—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ tenant_id. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ RefreshDatabase —Ç–∞ —ñ–º—ñ—Ç—É–π—Ç–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–ª–µ–π —è–∫ –≥–ª–æ–±–∞–ª—å–Ω–æ, —Ç–∞–∫ —ñ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ç–µ–Ω–∞–Ω—Ç—ñ–≤, –∞ –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ —Å—Ç–∞–Ω –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é assertDatabaseHas —Ç–∞ assertDatabaseMissing, –≤–∫–∞–∑—É—é—á–∏ tenant_id

---
